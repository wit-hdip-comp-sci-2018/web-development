<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/railscasts.min.css" rel="stylesheet" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom:thin solid black;
}

h2
{
  font-size:110%;
  border-bottom: thin solid black;
}

h3
{
  font-size:100%;
  border-bottom: thin solid black;
}

body
{
  overflow-y: scroll;
}

.pushable > .pusher
{
  padding-bottom: 1.5rem;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}



    </style>
  </head>

  <body>
    
    

    <div class="ui fixed top pointing inverted stackable menu labmenu">
      <header class="header item">
        <i id="toc" class="sitemap icon"></i>
        <a href="../index.html">
          12: Deployment + Review 
        </a>
      </header>
      <div class="right tab-menu menu">
        
          <a class="item" data-tab="Lab-12a Deploy">
            Lab-12a Deploy
          </a>
        
          <a class="item" data-tab="01">
            01
          </a>
        
          <a class="item" data-tab="02">
            02
          </a>
        
          <a class="item" data-tab="03">
            03
          </a>
        
          <a class="item" data-tab="04">
            04
          </a>
        
          <a class="item" data-tab="05">
            05
          </a>
        
          <a class="item" data-tab="06">
            06
          </a>
        
          <a class="item" data-tab="Exercises">
            Exercises
          </a>
        
        <div class="item">
          
        </div>
      </div>
    </div>

    <div class="ui segment pushable">
      <div class="ui inverted labeled icon left inline vertical sidebar menu">
        <br><br>
        
          
            <a class="item" href="../../topic01-introducing-html/book-a/index.html">
              Lab-1.1: Editing HTML
            </a>
          
        
          
            <a class="item" href="../../topic01-introducing-html/book-b/index.html">
              Lab-1.2: HTML Structure
            </a>
          
        
          
            <a class="item" href="../../topic02-inctroducing-css/book/index.html">
              Lab-2 CSS Intro
            </a>
          
        
          
            <a class="item" href="../../topic03-box-model/book-a/index.html">
              Lab-3a Layout
            </a>
          
        
          
            <a class="item" href="../../topic03-box-model/book-b/index.html">
              Lab-3b Multicolumn
            </a>
          
        
          
            <a class="item" href="../../topic04-navigation/book-a/index.html">
              Lab-4a Navigation 
            </a>
          
        
          
            <a class="item" href="../../topic04-navigation/book-b/index.html">
              Lab-4b Case Study
            </a>
          
        
          
            <a class="item" href="../../topic05-templating/book-01-harp/index.html">
              Lab-5a Harp & Surge
            </a>
          
        
          
            <a class="item" href="../../topic05-templating/book-02-templates/index.html">
              Lab-5b Templating
            </a>
          
        
          
            <a class="item" href="../../topic05-templating/book-03-nav-templates/index.html">
              Lab-5c Templating & Nav
            </a>
          
        
          
            <a class="item" href="../../topic06-css-frameworks/book-a/index.html">
              Lab-6a Semantic UI 1
            </a>
          
        
          
            <a class="item" href="../../topic06-css-frameworks/book-b/index.html">
              Lab-6b Semantic UI 2
            </a>
          
        
          
            <a class="item" href="../../topic07-starting-play/book-b-setup-play/index.html">
              Lab-07a Play Setup
            </a>
          
        
          
            <a class="item" href="../../topic07-starting-play/book-c-playlist-1/index.html">
              Lab-07b Playlist 1
            </a>
          
        
          
            <a class="item" href="../../topic08-introducing-mvc/book-a-playlist-2/index.html">
              Lab-08a Playlist-2
            </a>
          
        
          
            <a class="item" href="../../topic08-introducing-mvc/book-b-playlist-3/index.html">
              Lab-08b Playlist-3
            </a>
          
        
          
            <a class="item" href="../../topic09-forms/book-a-todolist/index.html">
              Lab-09b Todolist-1
            </a>
          
        
          
            <a class="item" href="../../topic09-forms/book-b-playlist-4/index.html">
              Lab-09a Playlist-4
            </a>
          
        
          
            <a class="item" href="../../topic10-sessions/book-sessions/index.html">
              Lab-10 Todolist-2
            </a>
          
        
          
            <a class="item" href="../../topic11-playlist-sessions/book-1/index.html">
              Lab-11a Playlist Review
            </a>
          
        
          
            <a class="item" href="../../topic11-playlist-sessions/book-2/index.html">
              Lab-11b Playlist 5
            </a>
          
        
          
            <a class="active item" href="../../topic12-deployment-review/book-a-deploy/index.html">
              Lab-12a Deploy
            </a>
          
        
          
            <a class="item" href="../../topic12-deployment-review/book-b-sourcetree/index.html">
              Lab-12b Git Setup
            </a>
          
        
          
            <a class="item" href="../../topic12-deployment-review/book-c-git/index.html">
              Lab-12c Git Usage
            </a>
          
        
      </div>
      <div class="pusher" tabindex="-1">
        <div class="ui basic segment" id="labchat">
          <br>
          
            <div  class="ui tab segment lab" data-tab="Lab-12a Deploy">
              <h1>Objectives</h1>
<p>Deploy a Play Application to the cloud</p>

            </div>
          
            <div  class="ui tab segment lab" data-tab="01">
              <h1>Setup.</h1>
<p>We need 2 free services to get our Play Application live in the Cloud. In this step we create the necessary accounts.</p>
<ul>
<li>Heroku</li>
<li>Dropbox</li>
</ul>
<h2>(1) Heroku</h2>
<p>Visit this site:</p>
<ul>
<li><a href="https://www.heroku.com">https://www.heroku.com</a></li>
</ul>
<p>And sign up for a new account.</p>
<p>Once confirmed, log in and go you your Dashboard:</p>
<ul>
<li><a href="https://dashboard.heroku.com/apps">https://dashboard.heroku.com/apps</a></li>
</ul>
<p>This is a Platform as a Service provided (PaaS), you can read about PaaS here:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Platform_as_a_service">https://en.wikipedia.org/wiki/Platform_as_a_service</a></li>
</ul>
<p>We will be using this service to get our Play Applications Live.</p>
<h2>(2) Dropbox</h2>
<p>If you do not already have one, create and account here:</p>
<ul>
<li><a href="https://www.dropbox.com/">https://www.dropbox.com/</a></li>
</ul>
<p>You will then need to download the Dropbox Application, which will be a native application installed on your computer:</p>
<ul>
<li><a href="https://www.dropbox.com/install">https://www.dropbox.com/install</a></li>
</ul>
<p>When this is installed, a folder called <code>Dropbox</code> will be created on your workstation - which will also be mirrored in the cloud. Make sure you can locate this folder and that it is in fact synced with the cloud.</p>

            </div>
          
            <div  class="ui tab segment lab" data-tab="02">
              <h1>Preparing the Play Application for Deployment</h1>
<p>You may have your own version of the Todolist 2 application - which you can use for the rest of this lab. Alternatively, you can download the the version we left at the end of lab 10:</p>
<ul>
<li><a href="https://github.com/edeleastar/todolist/releases/tag/todolist-2.end">https://github.com/edeleastar/todolist/releases/tag/todolist-2.end</a></li>
</ul>
<p>If you download the zip above, and expand - you will have a complete Play application like this:</p>
<p><img src="img/06.png" alt=""></p>
<p>We need to make the set the following parameters to prepare it for deployment:</p>
<ul>
<li>JDK Version</li>
<li>Play Version</li>
<li>Database Settings</li>
</ul>
<p>You may want to import the project into Idea to make the changes below.</p>
<h2>(1)JDK Version</h2>
<p>Create a new file in the project root:</p>
<h3>system.properties</h3>
<pre><code>java.runtime.version=8</code></pre>
<p>This sets the JDK version our app will need when deployed.</p>
<h2>(2) Play Version</h2>
<p>Locate this file:</p>
<h2>conf/dependencies.yml</h2>
<pre><code># Application dependencies

require:
    - play</code></pre>
<p>Change it to the following:</p>
<pre><code># Application dependencies

require:
    - play 1.5.0
    - org.postgresql -&gt; postgresql 42.2.2:
       force: true</code></pre>
<p>This determines the precise version of Play + the database drivers it should use.</p>
<h2>(3) Database Settings</h2>
<p>We also need to set the database connection configuration to use when deployed. Open <code>application.conf</code> and locate the following line:</p>
<h2>conf/application.conf</h2>
<pre><code>db.default=mem</code></pre>
<p>Comment out this line by placing a <code>#</code> in the first line:</p>
<pre><code># db.default=mem</code></pre>
<p>Insert the following directly below:</p>
<pre><code>db=${DATABASE_URL}
jpa.dialect=org.hibernate.dialect.PostgreSQLDialect
jpa.ddl=update</code></pre>
<p>NB: This very last change will mean that YOUR APP WILL NO LONGER RUN LOCALLY! (apologies for the caps). So you will need to reverse the very last change if you want to run locally again.</p>

            </div>
          
            <div  class="ui tab segment lab" data-tab="03">
              <h1>Creating &amp; Configure the Application on Heroku</h1>
<p>Now we need to create and configure the application on Heroku:</p>
<ul>
<li>Create App</li>
<li>Link to Dropbox</li>
<li>Configure Buildpack</li>
</ul>
<h2>(1) Create Application</h2>
<p>Back in the Heroku </p>
<ul>
<li><a href="https://www.heroku.com">https://www.heroku.com</a></li>
</ul>
<p>Log in and you should see the main Dashboard:</p>
<p><img src="img/07.png" alt=""></p>
<p>Select &#39;New` and create a new application.</p>
<p><img src="img/08.png" alt=""></p>
<p>Give the app a name - this will have to be unique, so perhaps consider using your initials or name in the application name:</p>
<p><img src="img/09.png" alt=""></p>
<p>You might also locate the app in Europe. Press <code>Create App</code> and an application console will be displayed:</p>
<p><img src="img/10.png" alt=""></p>
<h2>(2) Link to Dropbox</h2>
<p>One of the options is <code>Dropbox</code> ... press it and you will be asked to authorise against your Dropbox credentials.</p>
<p>The Control panel will now have these additional options.</p>
<p><img src="img/11.png" alt=""></p>
<p>Also, check your Dropbox folder on your workstation. It should have a new folder - the same name as the application you created - inside an <code>Dropbox/Apps/Heroku</code> folder</p>
<p><img src="img/12.png" alt=""></p>
<p>When we are ready to deploy our application we place a copy in here. Do this now, copy the contents of the todolist folder into the newly created folder:</p>
<p>It might look like this:</p>
<p><img src="img/13.png" alt=""></p>
<p>We now have 2 versions of our app - then one we are working on, perhaps in IDEA - and another version we have copied out to a dropbox folder.</p>
<p>If you are using one of your own projects, be sure to exclude a <code>.git</code> subdirectory (if there is one) from the copy on dropbox.</p>
<h2>(3) Configure Buildpack</h2>
<p>We are now almost ready to deploy. We need to do one more step. Back in Heroku, switch to the <code>Settings</code> panel:</p>
<p><img src="img/14.png" alt=""></p>
<p>Press the <code>Add Buildpack</code>:</p>
<p><img src="img/15.png" alt=""></p>
<p>In the above, we have added this url:</p>
<pre><code class="lang-text">https://github.com/heroku/heroku-buildpack-play</code></pre>
<p>Save changes and the buildpack should be installed:</p>
<p><img src="img/16.png" alt=""></p>
<p>The build pack is needed to inform Heroku how a play app is configured and managed.</p>

            </div>
          
            <div  class="ui tab segment lab" data-tab="04">
              <h1>Deploy the Application</h1>
<p>Back in the <code>Deploy</code> panel - we can now press the <code>Deploy</code> button.</p>
<p>This will take a minute or so - and will log its progress...</p>
<p>If all goes well -- it should look like this:</p>
<p><img src="img/18.png" alt=""></p>
<p>This could take a minute or two...</p>
<p>Note the green tick indicating it is deployed. Press <code>View</code> and the app should be available:</p>
<p><img src="img/19.png" alt=""></p>
<p>Log in as <code>homer@simpson.com</code>, <code>secret</code></p>
<p><img src="img/20.png" alt=""></p>
<p><img src="img/21.png" alt=""></p>
<p>You should be able to ad and remove todos. Log out, sign up a new user etc...</p>

            </div>
          
            <div  class="ui tab segment lab" data-tab="05">
              <h2>Logs</h2>
<p>Back in the Heroku Console - select <code>more</code> on the top right:</p>
<p><img src="img/22.png" alt=""></p>
<p>Select <code>View logs</code>. </p>
<p><img src="img/24.png" alt=""></p>
<p>This is the equivalent of the console when you were running the app locally on your workstation. When testing the deployed application it is useful to always keep this view open. It enables you to monitor the application, identify potential errors and generally keep an eye on its operation.</p>
<p>You now have 2 versions of the source of your application</p>
<ul>
<li>The version you are developing using IDEA</li>
<li>A copy of the application on a dropbox folder, shared with Heroku.</li>
</ul>
<p>It is a good idea to keep these separate - and when you update the application you copy the source over to the dropbox version.</p>
<h2>Running Locally</h2>
<p>Please note: This change you made to <code>conf/application.conf</code>:</p>
<h2>conf/application.conf</h2>
<pre><code># db.default=mem

db=${DATABASE_URL}
jpa.dialect=org.hibernate.dialect.PostgreSQLDialect
jpa.ddl=update</code></pre>
<p>Will prevent you from running the application locally. i.e. it will fail to launch when running via the <code>play run</code> command. Therefore, for the version of the application you are editing via IDEA, make suer to reverse the changes if you wish to run locally:</p>
<pre><code>db.default=mem

# db=${DATABASE_URL}
# jpa.dialect=org.hibernate.dialect.PostgreSQLDialect
# jpa.ddl=update</code></pre>
<p>Perhaps best to keep this file NOT in sync with the version on dropbox</p>
<h2>Deploying Again</h2>
<p>The procedure for updating the running app is to</p>
<ul>
<li>Copy the relevant source into the dropbox version</li>
<li>Press the <code>Deploy</code> button again:</li>
</ul>
<p><img src="img/25.png" alt=""></p>
<p>In the above example - it has not detected any changes, so will not deploy.</p>
<p>When deploying, the Build Logs become visible:</p>
<p><img src="img/26.png" alt=""></p>
<p>These logs are separate from the run time logs described above. You will need to monitor these logs occasionally in case any errors arise.</p>

            </div>
          
            <div  class="ui tab segment lab" data-tab="06">
              <h1>Database Dashboard</h1>
<p>If you have been relying on this link:</p>
<ul>
<li><a href="&#109;&#97;&#x69;&#x6c;&#x74;&#111;&#58;&#104;&#116;&#x74;&#112;&#58;&#47;&#47;&#108;&#111;&#99;&#97;&#x74;&#x68;&#x6f;&#x73;&#116;&#x39;&#x30;&#x30;&#x30;&#47;&#64;&#x64;&#98;">&#104;&#116;&#x74;&#112;&#58;&#47;&#47;&#108;&#111;&#99;&#97;&#x74;&#x68;&#x6f;&#x73;&#116;&#x39;&#x30;&#x30;&#x30;&#47;&#64;&#x64;&#98;</a> </li>
</ul>
<p>...to view the browser when running locally - this will NOT work for the deployed version. </p>
<p>However, Heroku supports a free add-on which fulfils a similiar role:</p>
<ul>
<li><a href="https://www.adminium.io/dashboard">https://www.adminium.io/dashboard</a></li>
</ul>
<p>Associating this service with your app is reasonably straightforward, and is all carried via the web interface.</p>
<p>It will involve installing the Addon:</p>
<p><img src="img/30.png" alt=""></p>
<p>This will ask for authorisation:</p>
<p><img src="img/27.png" alt=""></p>
<p>You will then be asked to enable it for your application - and you will eventually be able to browse its models like this:</p>
<p><img src="img/29.png" alt=""></p>
<p>You will even be able to edit the contents.</p>
<p>You will also be able to add tables to a <code>Dashboard</code> :</p>
<p><img src="img/31.png" alt=""></p>
<p>The dashboard is available at this url:</p>
<ul>
<li><a href="https://www.adminium.io/dashboard">https://www.adminium.io/dashboard</a></li>
</ul>
<p><img src="img/32.png" alt=""></p>
<p>There are additional Widgets you can experiment with here to monitor database activity over time.</p>

            </div>
          
            <div  class="ui tab segment lab" data-tab="Exercises">
              <h1>Exercises</h1>
<h2>Exercise 1: Deploy Playlist 5</h2>
<p>Deploy the latest playlist application:</p>
<ul>
<li><a href="https://github.com/edeleastar/playlist/releases/tag/playlist.5.end">https://github.com/edeleastar/playlist/releases/tag/playlist.5.end</a></li>
</ul>
<p>You will need to follow precisely steps 02, 03 and 04 from this lab.</p>
<h2>Exercise 2: Workspace</h2>
<p>See if you can arrange your workspace like this:</p>
<p><img src="img/33.png" alt=""></p>
<p>Here we are monitoring the deploy logs, the main application logs, the database console and the application itself (including the browser tools).</p>
<p>Try some variation of this now and get familiar with the nature of the information in each of the windows. Proceed through a deploy cycle while doing this (make a cosmetic change to the app in dropbox to allow a deploy to be triggered)</p>

            </div>
          
        </div>
      </div>
    </div>

    <script>
      $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

      $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

    </script>
  </body>
</html>